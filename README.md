# CLARE: Transcript Editor and Knowledge Graph Constructor

CLARE is a Windows application that turns time-aligned transcripts into interactive knowledge graphs.  
It provides two integrated workspaces: a transcript editor for precise, loop-based correction, and a knowledge graph view for generation, visualization, and refinement.  
You can run CLARE from the included executable or from source with Python 3.10.

---

## Quick start

### Use the included executable
- Double-click **CLARE_KG_Constructor.exe** in the release bundle.
- No Python setup is required.

### System requirements
- OS: Windows  
- Media support: install **FFmpeg** so audio and video features work reliably.  
  Download: https://ffmpeg.org/download.html  
  Ensure `ffmpeg.exe` is on your PATH.  
- Supported media: `.wmv` and `.wav` files  
- Built with: Python 3.10

## Transcript input formats

CLARE supports two transcript input formats. Examples of each are included in the `transcripts` folder of this repository.

1. **Generic JSON/CSV transcript format**  
   - Each row or entry must include:
     - `start` time (seconds)  
     - `end` time (seconds)  
     - `speaker` label (e.g., `speaker_0`)  
     - `text` (spoken words)  
   - This format is simple and works with most aligned transcripts.

2. **aTrain JSON format**  
   - CLARE also supports the JSON transcripts generated by the **aTrain** app.  
   - aTrain is a GUI-based transcription tool available on the Microsoft Store:  
     https://apps.microsoft.com/detail/9n15q44szns2?hl=en-US&gl=US  

---

## Run from source

### 1) Get the code
git clone https://github.com/ryanwaynehenry/CLARE  
cd CLARE  

### 2) Create a virtual environment

Using **venv**:
```
py -3.10 -m venv .venv
.\.venv\Scripts\activate
```

Using conda:
```
conda create -n clare python=3.10
conda activate clare
```
### 3) Install dependencies
```
pip install --upgrade pip
pip install -r requirements.txt
```
### 4) Run the GUI
```
python main_window.py
```

---

## Build a standalone executable with PyInstaller

Activate your environment, then run the following command.  
Update the two `--add-data` paths.
```
pyinstaller --noconfirm
--onefile --windowed
--name CLARE_KG_Constructor.exe --hidden-import=tiktoken_ext
--hidden-import=tiktoken_ext.openai_public --hidden-import=litellm_core_utils.llm_cost_calc.utils
--add-data "{your path to your virtual environment}\Lib\site-packages\litellm\litellm_core_utils\tokenizers;litellm\litellm_core_utils\tokenizers" --add-data "{your path to the project folder here}\imgs;imgs"
main_window.py
```

---

## What CLARE does

### High-level overview

CLARE provides a unified pipeline for transcript-based knowledge graphs with three interoperable parts:

1. **Time-synchronized transcript correction**  
   Load a `.wmv` or `.wav` and an aligned transcript. Review segments with looping and waveform highlighting. Edit timing, speaker labels, and text.

2. **Customizable knowledge graph construction**  
   Turn a corrected transcript into a graph through sentence grouping, embeddings, clustering, entity extraction and consolidation, association scoring, dynamic edge filtering, and relation extraction that uses transcript context.

3. **Interactive graph editing**  
   Generate the graph, search, filter, and directly edit nodes and edges. Export nodes and edges as CSV for reuse.

Our primary contribution extends AutoKG with a context-aware pipeline that transforms corrected transcripts into semantically labeled, directed triples. CLARE converts transcript segments into nodes and edges, then renders them in an interactive viewer for validation and refinement.

### Model flexibility

CLARE integrates **LiteLLM** and **Sentence-Transformers** so you can mix and match:
- Cloud LLMs and embedding services
- Local models through **Ollama**
- Local embeddings with **Sentence-Transformers**

This gives privacy and cost control while keeping the workflow in one app.

---

## Knowledge graph construction in CLARE

The pipeline performs these stages:

1. **Segmentation and embeddings** – Group adjacent transcript rows into discourse blocks and embed them.  
2. **Clustering** – Organize embeddings into themes. Number of clusters can be user-defined or auto-selected via silhouette score.  
3. **Entity extraction and consolidation** – Extract candidate entities per cluster, then consolidate globally.  
4. **Entity to text association** – Compute association scores, then threshold them into binary links.  
5. **Entity to entity weighting with pruning** – Build an adjacency matrix and prune weak edges.  
6. **Relation extraction with context** – Use transcript chunks to identify directed relation phrases.  
7. **Visualization and refinement** – Display the graph for interactive editing.  

---

## The GUI in detail

### Transcript Editor tab

- **Load Media**: load `.wmv` or `.wav`. Displays waveform and video if present.  
- **Load Transcript**: load aligned transcript JSON. Two formats supported: per-line `{start, end, speaker, text}` or aTrain JSON.  
- **Save Transcript**: write current transcript to JSON.  
- **Waveform view**: highlights current transcript row’s audio.  
- **Playback controls**: play/pause, jump forward/back 10s, looping toggle.  
- **Transcript table**: editable table with start time, end time, speaker, and text. Rows can be reordered, added, or deleted.  
- **Sort by Start**: reorders the transcript chronologically.  
- **Loop controls**: set loop start and end manually with spin boxes.  
- **Overlay toggle**: show/hide speaker overlay buttons on video.  

### Knowledge Graph tab

- **Central Topic**: filters entities and edges to match the given theme.  
- **Clustering Options**: advanced dialog to set number of clusters, per-cluster entity cap, and dynamic edge threshold.  
- **Model Selection**: choose embedding and language models (cloud or local).  
- **API Keys**: set credentials for cloud providers or local server addresses.  
- **Generate KG**: run the pipeline on the current transcript.  
- **Graph view**: interactive canvas where nodes can be moved, edited, merged, or deleted.  
- **Filters**: 
  - *Direct Connections*: show a node and its immediate neighbors.  
  - *Overlapping Connections*: show only relationships between selected nodes.  
- **Editing ribbon**: delete nodes/edges, reverse relationships, merge entities, or add new ones.  
- **Export**: save nodes and edges as CSV for reuse or import into tools like Neo4j.  

---

## Evaluation dataset: MINE

CLARE was evaluated using the **MINE dataset**, a collection of 105 articles spanning multiple topics such as cooking, urban legends, and butterfly life cycles.  
Each article provides 15 facts that can be embedded and mapped into graph triples.  
This dataset is openly available at the **KG-Gen project repository**:  
https://github.com/stair-lab/kg-gen


**Credits:**

<a href="https://www.flaticon.com/free-icons/undo" title="undo icons">Undo icons created by Freepik - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/open-folder" title="open folder icons">Open folder icons created by Freepik - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/save" title="save icons">Save icons created by Yogi Aprelliyanto - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/search" title="search icons">Search icons created by Chanut - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/hamburger" title="hamburger icons">Hamburger icons created by feen - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/play" title="play icons">Play icons created by Freepik - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/pause" title="pause icons">Pause icons created by inkubators - Flaticon</a>